(function($){var t=$.tools.overlay,w=$(window);$.extend(t.conf,{start:{top:null,left:null},fadeInSpeed:'fast',zIndex:9999});function getPosition(el){var p=el.offset();return{top:p.top+el.height()/2,left:p.left+el.width()/2};}var loadEffect=function(pos,onLoad){var overlay=this.getOverlay(),conf=this.getConf(),trigger=this.getTrigger(),self=this,oWidth=overlay.outerWidth({margin:true}),img=overlay.data("img"),position=conf.fixed?'fixed':'absolute';if(!img){var bg=overlay.css("backgroundImage");if(!bg){throw"background-image CSS property not set for overlay";}bg=bg.slice(bg.indexOf("(")+1,bg.indexOf(")")).replace(/\"/g,"");overlay.css("backgroundImage","none");img=$('<img src="'+bg+'"/>');img.css({border:0,display:'none'}).width(oWidth);$('body').append(img);overlay.data("img",img);}var itop=conf.start.top||Math.round(w.height()/2),ileft=conf.start.left||Math.round(w.width()/2);if(trigger){var p=getPosition(trigger);itop=p.top;ileft=p.left;}if(conf.fixed){itop-=w.scrollTop();ileft-=w.scrollLeft();}else{pos.top+=w.scrollTop();pos.left+=w.scrollLeft();}img.css({position:'absolute',top:itop,left:ileft,width:0,zIndex:conf.zIndex}).show();pos.position=position;overlay.css(pos);img.animate({top:overlay.css("top"),left:overlay.css("left"),width:oWidth},conf.speed,function(){overlay.css("zIndex",conf.zIndex+1).fadeIn(conf.fadeInSpeed,function(){if(self.isOpened()&&!$(this).index(overlay)){onLoad.call();}else{overlay.hide();}});}).css("position",position);};var closeEffect=function(onClose){var overlay=this.getOverlay().hide(),conf=this.getConf(),trigger=this.getTrigger(),img=overlay.data("img"),css={top:conf.start.top,left:conf.start.left,width:0};if(trigger){$.extend(css,getPosition(trigger));}if(conf.fixed){img.css({position:'absolute'}).animate({top:"+="+w.scrollTop(),left:"+="+w.scrollLeft()},0);}img.animate(css,conf.closeSpeed,onClose);};t.addEffect("apple",loadEffect,closeEffect);})(jQuery);